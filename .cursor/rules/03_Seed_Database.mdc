---
description: 
globs: 
alwaysApply: false
---
# MDC Context: 03 - Seed Database (Revised w/ Structure)

## Goal

Populate the database with assessment data from `questions.json` using a script located at `scripts/seedDatabase.ts`.

## Steps

1.  **Ensure Admin Client Exists:**
    * Verify `src/lib/supabase/admin.ts` is created (as defined in `01_*`).
    * **Ensure `SUPABASE_SERVICE_ROLE_KEY` is set in `.env.local`** (Get from Supabase Dashboard -> Project Settings -> API). This key must be kept secret.

2.  **Create Seed Script `scripts/seedDatabase.ts`:**
    * Place the script in the `scripts/` directory.
    * Import `supabaseAdmin` from `../src/lib/supabase/admin`.
    * Import `fs` and `path` for reading the JSON file.
    * Define TypeScript interfaces matching the structure of `questions.json` for type safety.
    * Read and parse `questions.json` (ensure the path relative to the script is correct, e.g., `path.resolve(__dirname, '../questions.json')`).
    * Implement the logic to iterate through the JSON structure (parts, blocks, questions, etc.) and insert data into the corresponding tables using `supabaseAdmin.from('table_name').insert(...)`.
    * Handle the fetching and passing of IDs between related inserts (e.g., get `assessment.id` before inserting `parts`).
    * *(Refer to the conceptual code snippet in the previous response for the logic structure)*.
    * *Gotcha:* This script requires careful handling of asynchronous operations (`async/await`) and potential errors during insertion. Add robust logging.

3.  **Install Script Runner (if needed):**
    * If not already installed from previous steps:
        ```bash
        npm install -D ts-node typescript @types/node
        ```

4.  **Run the Seed Script:**
    * From the project root (`assessment-app/`):
        ```bash
        npx ts-node ./scripts/seedDatabase.ts
        ```
    * Check the console output for success or errors. Verify data in the Supabase dashboard.

## Outcome

The database is populated via the script in `scripts/seedDatabase.ts`. The app now has assessment content to work with.